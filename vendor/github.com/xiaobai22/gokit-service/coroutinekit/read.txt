package main

import(

	"github.com/xiaobai22/gokit-service/coroutinekit"
	"time"
	"fmt"

)
var co *coroutinekit.CoroutineKit
func init(){
	co = coroutinekit.NewCoroutineKit()
}

func s(){
	defer func(){
		if co := recover(); co != nil{
			time.Sleep(time.Millisecond)
			s()
		}

	}()
	for i:=1;i<10000000;i++{
		time.Sleep( time.Millisecond*1)
		//fmt.Println("running2")
		if i%40 == 0{
			panic("some error oh no")
			return

		}
	}
}
func s2(){
	for i:=1;i<10000000;i++{
		time.Sleep( time.Millisecond*1)
		//fmt.Println("running2")
		if i%40 == 0{
			panic("some error oh no")
			return

		}
	}
}
//m.Start(  "name", num, f(), panicRestart )
func main(){
	co.StartMonitor("9090")
	go show2()
	go show2()
	fmt.Println(co.Start("正在 进行推送任务", 30, s , true ))
	fmt.Println(co.Start("正在 进行快速推送任务", 30, s2 , true ))
	fmt.Println(co.Start("正在 进行快速推送任务2", 30, s2 , false ))
	time.Sleep( time.Second*10000)
}

func show2(){
	for{
		time.Sleep(time.Millisecond)
		 co.Show("")
	}
}